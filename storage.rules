rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {

    // ==========================
    // Profile Pictures
    // ==========================
    match /profile-pictures/{userId}/{fileName} {
      // Anyone can view profile pictures
      allow read: if true;

      // Only the owner can upload/update/delete their own profile picture
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    // ==========================
    // Assignments
    // ==========================
    match /assignments/{allPaths=**} {
      // Any authenticated user (student, faculty, etc.) can read assignment files.
      allow read: if request.auth != null;

      // Only users with a 'faculty' or 'admin' role in Firestore can write files.
      allow write: if request.auth != null &&
                   get(/databases/(default)/documents/users/$(request.auth.uid)).data.role in ['faculty', 'admin'];
    }
  }
}
